## 序列相似性分析 - 4篇论文

### 01 Blanket- BLEX

假设：观察执行集在受控随机环境下执行时的函数副作用，如果在相同环境下观察到的副作用相似，则认为这两个功能是相似的

提出：BLEX，覆盖执行技术，

结果：

- BLEX在正确识别类似函数方面比bindiff高3.5倍
- 如果是不同编译器编译的，性能也优于BinDiff
- 构建了一个二元搜索引擎，可以跨优化边界识别类似的函数，

核心思想是：相同的输入，比较执行行为的相似性



### 02 BinSim

基于跟踪的 系统调用切片段 等价

方法：识别执行轨迹之间 细粒度的 语义相似性或差异性 

执行增强的动态切片和符号执行，以比较影响可观测行为的指令逻辑？

结果：成功识别模糊二进制之间的细粒度关系

应用：补丁-1day漏洞 / 专利保护

语义感知二进制-

1. 比较运行时行为，而不是指令字节，通过行为特征的相似性：系统调用序列和依赖图
2. 测量两段二进制码的语义

将一个基本块输入-输出表示为一组符号公式，用约束求解器，随机抽样。哈希 来证明等价，块中心，limit在于 不足以捕获超越单个基本块边界的相似点或差异，

集合了符号执行和动态向后切片 来比较于行为相关的指令段

动态切片，记录最弱的前提条件，=约束求解器，已验证他们是否等效

### 03 内存内fuzzing - 二进制代码相似性分析

IMF-SIM：对每个功能进行分析，并收集不同类型程序行为的痕迹，根据两个行为轨迹的最长公共子序列，计算他们的相似度得分，为了比较两个函数，生成一个特征向量，其元素是行为跟踪级别比较的相似度得分，通过标记的特征向量训练机器学习模型，然后对于给定的特征向量，通过比较两个函数训练模型给出的最终的得分，表示两个函数的相似度的得分，

最长公共子序列 - 相似度得分-特征向量-训练机器学习模型-得分



### 04- TREX

迁移学习，无监督预训练任务，从函数执行微轨迹中学习执行语义

masked LM 预训练模型-新的神经架构（层次转换器）-学习执行语义

训练ML 模型 从欠约束动态跟踪中 学习近似的执行语义，

使用不同的轨迹上的预训练模型来学习每条指令在其上下文中的执行效果，然后，TREX通过转移从预处理中学习到的知识来匹配语义相似的函数，微调模型，，

---

## 综述 - 二进制相似性比较

比较方法：

一对一、一对多、多对多

粒度：

指令级别、函数级别、基本块、程序

比较

语法相似、结构相似、语义相似

语法相似

通过比较指令序列来判断相似性。序列中的指令在虚拟地址空间中是连续的，并且属于同一个函数。序列中的指令可以首先被规范化，例如仅保留操作码或将操作数规范化等。

指令序列可以是固定或可变长度的。固定大小的序列是通过在指令流上滑动窗口获得的，例如 n-gram、nperms 等。比较指令序列的方法主要是计算哈希、Embedding 和 Alignment：

- 6 个工作（BMAT、DR2005、SWPQS2006、SMIT、BINCLONE、SPAIN）使用哈希从可变长度指令序列中计算固定长度哈希。
- 5 个工作（IDEA、MBC、MUANTX-S、EXPOS´E、KAM1N0）通过 n-gram 序列生成 Embedding。
- **3 个工作（EXEDIFF、TRACY、BINSEQUENCE）使用 Alignment 通过在任一序列中插入 gap 来对齐两个序列以生成它们之间的映射，解释插入、删除和修改的指令**。

结构相似

常见方式是通过图结构判断结构相似性，最常见的图是控制流图（CFG）、过程间控制流图（ICFG）和函数调用图（CG）。在 CFG 和 ICFG 中，节点是基本块，边表示控制流跳转。在 CG 中，节点是函数，边表示调用关系。判断图相似的子图同构是一个 NP 完全问题，其他方法如最大公共子图同构也是一个 NP 完全问题，比较时需要减少比对的图的数量和大小才能提高效率。

有 27 个工作采用了结构相似性判断。其中，14 个工作只使用了 CFG、4 个工作只使用了 ICFG、2 个工作只使用了 CG。

语义相似

 一共有 26 个计算语义相似度的工作，大部分在基本块的粒度上捕获语义，捕获语义的三种基本方法是：指令分类、输入输出对、符号公式。 



### 特征相似

有 28 个工作将二进制代码表示为一个向量或者一组特征，确保相似的二进制代码具有相似的特征向量，特征可以是布尔型、数值型或类别型。衡量特征相似通常使用 Jaccard 系数、位向量的点积以及数字向量的欧几里得或余弦距离。

最近 Embedding 很火热，有助于降低特征维度并增加特征向量的密度。下图是两种特征提取方式：

![二进制代码相似分析综述](https://cn-sec.com/wp-content/themes/begin-lts-1/img/blank.gif)

特别的，近五年来机器学习在该领域也得到了广泛应用，可用于无监督相似聚类/分类等任务。

### 哈希

主要有三类哈希可用：密码学哈希、局部敏感哈希和可执行文件哈希。共有 11 个工作使用了局部敏感哈希，其中 7 个都使用了 MinHash（BINHASH、MULTIMH、GENIUS、BINSEQUENCE、BINSHAPE、CACOMPARE、BINSIGN）。其他局部敏感哈希如 ssdeep、tlsh 等，所有的工作都没有使用，有研究表明这些局部敏感哈希作用于整个程序的相似性效果会比部分内容的相似性更好，这可能和工作的预期目标不太相符。

### 架构

不同体系结构的代码语法可能有很大不同，因为它们可能使用具有不同指令助记符、寄存器组和默认调用约定的单独指令集。所有 16 个跨架构比较的工作都是在 2015 年以后提出的，主要有两条技术路线：7 个工作选择将二进制代码提升为与体系结构无关的中间表示（IR），另外 9 个工作为每个架构设计独立的模块提取特征再判断相似性。

### 分析类型

可以使用静态分析、动态分析或两者结合的方式进行分析。有 51 个工作只使用静态分析，有 4 个工作只使用动态分析，有 6 个工作将二者结合使用。此外，也有工作使用污点分析与符号执行。

二进制代码相似中的动态分析普遍用于恶意软件脱壳（SMIT、BEAGLE、MUANTX-S、CXZ2014、BINSIM）、Trace 粒度跟踪（BINSIM、KS2017）以及收集语义相似性的运行时值（BLEX、 BINSIM、IMF-SIM）。

相关工作

图

firmup、Genius、Gemini、 VulSeeker

DiscovRE 、XMatch、Multi-MH、BinARM、 aDiff

根据开源与否，是否用到中间语言，分类





---

## 固件安全分析-符号执行

静态分析

动态分析

符号执行

相关工作

图

Avatar FIE FirmAlice FirmUSB 

S2E / angr / KLEE / 

LLVM / qemu-tcg / 